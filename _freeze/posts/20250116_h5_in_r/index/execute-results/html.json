{
  "hash": "4e57488c528a6d3077b3b874c8516f60",
  "result": {
    "engine": "knitr",
    "markdown": "---\nauthor: Amel Zulji\ntitle: \"HDF5 files in R\"\ndescription: \"Working with HDF5 files in R\"\ndate: 2023.02.02\nimage: hdf5_structure4.jpg\ncategories:\n  - file\ndraft: true\n---\n\n\n\n# Introduction\n\nHDF5 (Hierarchical Data Format v5) is a binary file format designed for efficient storage and fast access to large, structured datasets. Its binary nature ensures compact size and high read/write speed, making it ideal for data-intensive applications. HDF5 supports a hierarchical layout (like folders and files) and is well-suited for storing complex objects such as expression matrices its column- and rownames, metadata etc etc. It’s supported in many programming languages, making it highly suitable for interoperable, transferable workflows across platforms and tools.\n\nTo demonstrate how one can work with HDF5 in R, the {hdf5r} package will be used to write and read HDF5 files.\n\n# Simulating Example Data\n\nFirst, we simulate a small gene expression matrix and some associated metadata.\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsuppressPackageStartupMessages({\n  library(hdf5r)\n  library(tibble)\n})\n\nn_col <- 20\ncol_name <- paste0(\"cell\", 1:n_col)\nn_row <- 15\nrow_name <- paste0(\"gene\", 1:n_row)\ncounts <- matrix(rnorm(n_col * n_row), nrow = n_row, ncol = n_col, dimnames = list(row_name, col_name))\ncounts[1:5,1:5]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           cell1      cell2       cell3      cell4       cell5\ngene1  0.1740654  0.4289290 -1.43676165  0.2105156 -0.89810010\ngene2 -0.5816731  0.8298230  0.05956842  1.1447079  1.18680080\ngene3 -0.7213084 -0.1105271 -0.52643293 -0.4163313  1.40734412\ngene4 -0.4800708  2.3897391  0.92630349 -2.2724715 -1.98894960\ngene5 -0.9928075 -1.7549911  0.82384563 -1.5182478 -0.09224864\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmetadata <- tibble(barcode = col_name, metric = sample(letters, size = n_col))\nhead(metadata)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 2\n  barcode metric\n  <chr>   <chr> \n1 cell1   n     \n2 cell2   f     \n3 cell3   z     \n4 cell4   u     \n5 cell5   p     \n6 cell6   k     \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfilename <- \"seu_obj.h5\"\nfileh5 <- H5File$new(filename, mode = \"w\")\n\nfileh5$create_group(name = c(\"count_matrix\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nClass: H5Group\nFilename: /home/amelzulji/zuljiamel/posts/20250116_h5_in_r/seu_obj.h5\nGroup: /count_matrix\n```\n\n\n:::\n\n```{.r .cell-code}\nfileh5[[\"count_matrix\"]]$create_dataset(name = \"counts\", robj = counts)\nfileh5[[\"count_matrix\"]]$create_dataset(name = \"counts_colnames\", robj = col_name)\nfileh5[[\"count_matrix\"]]$create_dataset(name = \"counts_rownames\", robj = row_name)\n\nfileh5$create_group(name = c(\"cell_metadata\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nClass: H5Group\nFilename: /home/amelzulji/zuljiamel/posts/20250116_h5_in_r/seu_obj.h5\nGroup: /cell_metadata\n```\n\n\n:::\n\n```{.r .cell-code}\nfileh5[[\"cell_metadata\"]]$create_dataset(name = \"metadata\", robj = metadata)\nfileh5[[\"cell_metadata\"]]$create_dataset(name = \"metadata_colnames\", robj = colnames(metadata))\nfileh5[[\"cell_metadata\"]]$create_dataset(name = \"metadata_rownames\", robj = rownames(metadata))\n\nfileh5$close_all()\n\nseu_obj_data <- H5File$new(filename = \"seu_obj.h5\", mode = \"r\")\ncounts <- seu_obj_data[[\"count_matrix\"]][[\"counts\"]]\nrownames <- seu_obj_data[[\"count_matrix\"]][[\"counts_rownames\"]]\ncolnames <- seu_obj_data[[\"count_matrix\"]][[\"counts_colnames\"]]\n\nmat <- counts$read()\nrownames(mat) <- rownames$read()\ncolnames(mat) <- colnames$read()\n\nmat[1:5,1:5]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           cell1      cell2       cell3      cell4       cell5\ngene1  0.1740654  0.4289290 -1.43676165  0.2105156 -0.89810010\ngene2 -0.5816731  0.8298230  0.05956842  1.1447079  1.18680080\ngene3 -0.7213084 -0.1105271 -0.52643293 -0.4163313  1.40734412\ngene4 -0.4800708  2.3897391  0.92630349 -2.2724715 -1.98894960\ngene5 -0.9928075 -1.7549911  0.82384563 -1.5182478 -0.09224864\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfile.remove(\"seu_obj.h5\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}